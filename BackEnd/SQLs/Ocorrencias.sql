CREATE TABLE OCORRENCIAS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	DESCRICAO VARCHAR(500), 
	DATAHORA DATETIME,
	CADASTROUBOLETIMOCORRENCIA BIT
);

INSERT INTO OCORRENCIAS (DESCRICAO, DATAHORA, CADASTROUBOLETIMOCORRENCIA)
VALUES 
('Ocorrência 1', CONVERT(DATETIME, '2024-05-26 08:00:00', 120), 1),
('Ocorrência 2', CONVERT(DATETIME, '2024-05-26 09:15:00', 120), 0),
('Ocorrência 3', CONVERT(DATETIME, '2024-05-26 10:30:00', 120), 1),
('Ocorrência 4', CONVERT(DATETIME, '2024-05-26 11:45:00', 120), 0),
('Ocorrência 5', CONVERT(DATETIME, '2024-05-26 13:00:00', 120), 1),
('Ocorrência 6', CONVERT(DATETIME, '2024-05-26 14:15:00', 120), 0),
('Ocorrência 7', CONVERT(DATETIME, '2024-05-26 15:30:00', 120), 1),
('Ocorrência 8', CONVERT(DATETIME, '2024-05-26 16:45:00', 120), 0),
('Ocorrência 9', CONVERT(DATETIME, '2024-05-26 18:00:00', 120), 1),
('Ocorrência 10', CONVERT(DATETIME, '2024-05-26 19:15:00', 120), 0),
('Ocorrência 11', CONVERT(DATETIME, '2024-05-26 20:30:00', 120), 1),
('Ocorrência 12', CONVERT(DATETIME, '2024-05-26 21:45:00', 120), 0),
('Ocorrência 13', CONVERT(DATETIME, '2024-05-26 22:00:00', 120), 1),
('Ocorrência 14', CONVERT(DATETIME, '2024-05-26 23:15:00', 120), 0),
('Ocorrência 15', CONVERT(DATETIME, '2024-05-27 08:30:00', 120), 1),
('Ocorrência 16', CONVERT(DATETIME, '2024-05-27 09:45:00', 120), 0),
('Ocorrência 17', CONVERT(DATETIME, '2024-05-27 11:00:00', 120), 1),
('Ocorrência 18', CONVERT(DATETIME, '2024-05-27 12:15:00', 120), 0),
('Ocorrência 19', CONVERT(DATETIME, '2024-05-27 13:30:00', 120), 1),
('Ocorrência 20', CONVERT(DATETIME, '2024-05-27 14:45:00', 120), 0);


ALTER TABLE OCORRENCIAS
ADD TIPOOCORRENCIA int;

UPDATE ocorrencias
SET tipoocorrencia = 1
where id < 10;

UPDATE ocorrencias
SET tipoocorrencia = 2
where id >= 10;


CREATE TABLE ASSALTOS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	QUANTIDADEAGRESSORES INT, 
	POSSUIARMA BIT,
	OCORRENCIAID INT
);

ALTER TABLE ASSALTOS
ADD CONSTRAINT ASSALTOS_OCORRENCIAS_FK FOREIGN KEY (OCORRENCIAID) REFERENCES OCORRENCIAS (ID);

INSERT INTO ASSALTOS (QUANTIDADEAGRESSORES, POSSUIARMA, OCORRENCIAID)
VALUES
    (3, 1, 3),
    (2, 0, 4),
    (1, 1, 5),
    (4, 1, 6),
    (2, 0, 7),
    (1, 0, 8),
    (3, 1, 9),
    (2, 0, 10)

CREATE TABLE TIPOARMAS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	DESCRICAO VARCHAR(30), 
	ARMADEFOGO BIT
);


ALTER TABLE ASSALTOS
ADD TIPOARMAID INT;

ALTER TABLE ASSALTOS
ADD CONSTRAINT ASSALTOS_TIPOARMAS_FK FOREIGN KEY (TIPOARMAID) REFERENCES TIPOARMAS (ID);

INSERT INTO TIPOARMAS (DESCRICAO, ARMADEFOGO) 
VALUES 
('Pistola', 1),
('Fuzil', 1),
('Faca', 0),
('Revólver', 1),
('MotoSerra', 0);

UPDATE ASSALTOS
SET tipoarmaid = 2;


CREATE TABLE ROUBOS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	OCORRENCIAID INT
);

ALTER TABLE ROUBOS
ADD CONSTRAINT ROUBOS_OCORRENCIAS_FK FOREIGN KEY (OCORRENCIAID) REFERENCES OCORRENCIAS (ID);

INSERT INTO ROUBOS (OCORRENCIAID) 
VALUES 
    (11),
    (12),
    (13),
    (14),
    (15),
    (16),
    (17)


CREATE TABLE TIPOBENS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	NOME VARCHAR(30)
);

CREATE TABLE ASSALTOSTIPOBENS
(
	ASSALTOID INT NOT NULL,
	TIPOBEMID INT NOT NULL
);
 


ALTER TABLE ASSALTOSTIPOBENS
ADD CONSTRAINT ASSALTOSTIPOBENS_ASSALTOS_FK FOREIGN KEY (ASSALTOID) REFERENCES ASSALTOS (ID);

ALTER TABLE ASSALTOSTIPOBENS
ADD CONSTRAINT ASSALTOSTIPOBENS_TIPOBENS_FK FOREIGN KEY (TIPOBEMID) REFERENCES TIPOBENS (ID);

ALTER TABLE ASSALTOSTIPOBENS
ADD CONSTRAINT ASSALTOSTIPOBENS_PK PRIMARY KEY CLUSTERED (ASSALTOID, TIPOBEMID);

INSERT INTO TIPOBENS (NOME) 
VALUES 
    ('Item A'),
    ('Item B'),
    ('Item C'),
    ('Item D'),
    ('Item E');


CREATE TABLE ROUBOSTIPOBENS
(
	ROUBOID INT NOT NULL,
	TIPOBEMID INT NOT NULL
);
 


ALTER TABLE ROUBOSTIPOBENS
ADD CONSTRAINT ROUBOSTIPOBENS_ROUBOS_FK FOREIGN KEY (ROUBOID) REFERENCES ROUBOS (ID);

ALTER TABLE ROUBOSTIPOBENS
ADD CONSTRAINT ROUBOSTIPOBENS_TIPOBENS_FK FOREIGN KEY (TIPOBEMID) REFERENCES TIPOBENS (ID);

ALTER TABLE ROUBOSTIPOBENS
ADD CONSTRAINT ROUBOSTIPOBENS_PK PRIMARY KEY CLUSTERED (ROUBOID, TIPOBEMID);

CREATE TABLE INDOCORRENCIAS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	NUMBO VARCHAR(30),
	DATAOCORRENCIA DATETIME,
	TIPO INT,
	CIDADE VARCHAR(50),
	LATITUDE DECIMAL(10,5),
	LONGITUDE DECIMAL(10,5)
);

drop table INDOCORRENCIAS

ALTER TABLE INDOCORRENCIAS ALTER COLUMN LONGITUDE DECIMAL(10,5);


INSERT INTO INDOCORRENCIAS (NUMBO, DATAOCORRENCIA, TIPO, CIDADE, LATITUDE, LONGITUDE)
VALUES ('ABC123', '2024-06-22T15:30:00', 1, 'São Paulo', -50.555, -50.555);

INSERT INTO INDOCORRENCIAS (NUMBO, DATAOCORRENCIA, TIPO, CIDADE, LATITUDE, LONGITUDE)
VALUES
    ('202400001', '2024-06-29T10:15:00', 1, 'São Paulo', -23.55052, -46.63330),
    ('202400002', '2024-06-28T14:30:00', 1, 'Rio de Janeiro', -22.9068, -43.1729),
    ('202400003', '2024-06-27T08:45:00', 1, 'Brasília', -15.8267, -47.9218),
    ('202400004', '2024-06-26T11:00:00', 1, 'Salvador', -12.9714, -38.5014),
    ('202400005', '2024-06-25T16:20:00', 1, 'Fortaleza', -3.7172, -38.5433),
    ('202400006', '2024-06-24T09:00:00', 1, 'Recife', -8.0476, -34.8770),
    ('202400007', '2024-06-23T13:45:00', 1, 'Porto Alegre', -30.0346, -51.2177),
    ('202400008', '2024-06-22T15:10:00', 1, 'Belém', -1.4558, -48.5038),
    ('202400009', '2024-06-21T07:55:00', 1, 'Curitiba', -25.4296, -49.2719),
    ('202400010', '2024-06-20T18:30:00', 1, 'Manaus', -3.1190, -60.0217);

select * from INDOCORRENCIAS

CREATE TABLE PROCESSOS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	TIPO INT,
	DATACRIACAO DATETIME,
	DATAEXECUCAO DATETIME,
	STATUSATUAL INT
);

INSERT INTO PROCESSOS (TIPO, DATACRIACAO, DATAEXECUCAO, STATUSATUAL)
VALUES 
    (1, CONVERT(DATETIME, '2024-05-26 08:00:00', 120),CONVERT(DATETIME, '2024-05-26 08:00:00', 120), 0),
    (1, CONVERT(DATETIME, '2024-05-26 08:00:00', 120),CONVERT(DATETIME, '2024-05-26 08:00:00', 120), 0)

delete from PROCESSOS


CREATE TABLE ZONAS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	LATITUDECENTRAL VARCHAR(30),
	LONGITUDECENTRAL VARCHAR(30),
	RAIO DECIMAL(15,2),
	AREA DECIMAL(15,2),
	ATIVO BIT
);

INSERT INTO ZONAS (LATITUDECENTRAL, LONGITUDECENTRAL, RAIO, AREA, ATIVO)
VALUES ('-23.5505', '-46.6333', 10.5, 100.75, 1);

CREATE TABLE INDASSALTOS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	DATAINICIO DATETIME,
	DATAFIM DATETIME,
	DATAAGENDAMENTO DATETIME,
	INDICEASSALTO DECIMAL(15,2),
	ATIVO BIT,
	ZONAID INT
);

ALTER TABLE INDASSALTOS
ADD CONSTRAINT INDASSALTOS_ZONAS_FK FOREIGN KEY (ZONAID) REFERENCES ZONAS (ID);



select * from PROCESSOS

select * from INDOCORRENCIAS

--Utilizar essa formula para pegar a distancia de uma coordenada (ponto central)
--Até uma segunda coordenada, se for maior que o raio de alcance da zona não está dentro da área

select * from
(
	SELECT *, (6371 *
			acos(
				cos(radians(-23.5505)) *
				cos(radians(latitude)) *
				cos(radians(-46.6333) - radians(longitude)) +
				sin(radians(-23.5505)) *
				sin(radians(latitude))
			)) AS distance
	FROM INDOCORRENCIAS 
) a
where distance <10.5

select * from zonas

select * from INDOCORRENCIAS

ALTER TABLE ZONAS
ALTER COLUMN LATITUDECENTRAL DECIMAL(10,2);

ALTER TABLE ZONAS
ALTER COLUMN LONGITUDECENTRAL DECIMAL(10,2);

SELECT DISTANCIA FROM
                            (
	                            SELECT (6371 *
			                            acos(
				                            cos(radians(-23.189287)) *
				                            cos(radians(latitude)) *
				                            cos(radians(-45.886829) - radians(longitude)) +
				                            sin(radians(-23.189287)) *
				                            sin(radians(latitude))
			                            )) AS DISTANCIA
	                            FROM INDOCORRENCIAS 
								where tipo = 1
                            ) A
                            WHERE DISTANCIA <= 3.0
							



CREATE TABLE CIDADES
(
	ID int PRIMARY KEY IDENTITY(1,1),
	NOME VARCHAR(100)
);

ALTER TABLE CIDADES
ADD AREA DECIMAL(12,3)


CREATE TABLE INDMEDIOS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	DATACADASTRO DATETIME,
	TIPOINDICE INT,
	VALOR DECIMAL(10,3),
	CIDADEID INT
);

ALTER TABLE INDMEDIOS
ADD CONSTRAINT INDMEDIOS_CIDADES_FK FOREIGN KEY (CIDADEID) REFERENCES CIDADES (ID);

insert into cidades(nome, area)
values('São José dos Campos', 1000);

INSERT INTO INDMEDIOS (DATACADASTRO, VALOR, CIDADEID)
VALUES
    ('2024-06-29T10:15:00',  0.3, 2)




select * from INDMEDIOS

select * from  cidades

select * from indocorrencias

alter table indocorrencias
alter column longitude decimal(15,6)


SELECT * FROM ZONAS

ALTER TABLE ZONAS 
ADD LATITUDECENTRAL decimal(15,6)

ALTER TABLE ZONAS 
drop COLUMN LONGITUDECENTRAL

ALTER TABLE ZONAS
ADD CONSTRAINT ZONAS_CIDADES_FK FOREIGN KEY (CIDADEID) REFERENCES CIDADES (ID);


cidade - 10 ocorrencias - area 1000 km²
Média divido as ocorrencias pela area = 0,01
Acima da média = alta
abaixo da média = baixa	


zona - 3 ocorrencias - area 20km²
= 0,15

select * from processos





update processos
set statusatual = 0

select * from cidades

select * from processos

select * from indROUBOS

select * from indocorrencias
where tipo = 1

select * from indROUBOS

select * from INDFURTOS

--delete from processos

delete from INDFURTOS

--delete from indocorrencias

--delete from zonas

CREATE TABLE INDFURTOS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	DATAINICIO DATETIME,
	DATAFIM DATETIME,
	DATAAGENDAMENTO DATETIME,
	INDICEFURTO DECIMAL(15,2),
	ATIVO BIT,
	ZONAID INT
);

ALTER TABLE INDFURTOS
ADD CONSTRAINT INDFURTOS_ZONAS_FK FOREIGN KEY (ZONAID) REFERENCES ZONAS (ID);


CREATE TABLE USUARIOS
(
	ID int PRIMARY KEY IDENTITY(1,1),
	NOME VARCHAR(50),
	EMAIL VARCHAR(50),
	SENHA VARCHAR(50),
	CPF VARCHAR(15)
	REFRESHTOKEN VARCHAR(500),
	REFRESHTOKENEXPIRYTIME DATETIME
);

CREATE TABLE PERMISSOES
(
	ID int PRIMARY KEY IDENTITY(1,1),
	NOME VARCHAR(50)
);

CREATE TABLE USUARIOSPERMISSOES
(
	USUARIOID INT NOT NULL,
	PERMISSAOID INT NOT NULL
);





ALTER TABLE USUARIOSPERMISSOES
ADD CONSTRAINT USUARIOSPERMISSOES_USUARIOS_FK FOREIGN KEY (USUARIOID) REFERENCES USUARIOS (ID);

ALTER TABLE USUARIOSPERMISSOES
ADD CONSTRAINT USUARIOSPERMISSOES_PERMISSOES_FK FOREIGN KEY (PERMISSAOID) REFERENCES PERMISSOES (ID);

ALTER TABLE USUARIOSPERMISSOES
ADD CONSTRAINT USUARIOSPERMISSOES_PK PRIMARY KEY CLUSTERED (USUARIOID, PERMISSAOID);


INSERT INTO USUARIOS (NOME, EMAIL, SENHA, REFRESHTOKEN, REFRESHTOKENEXPIRYTIME)
VALUES ('João Silva', 'joao.silva@email.com', '123', 'refreshToken123', '2024-07-06 12:00:00');

INSERT INTO PERMISSOES (NOME)
VALUES ('ADMIN');


INSERT INTO USUARIOSPERMISSOES (USUARIOID,PERMISSAOID )
VALUES (1,1);

select * from USUARIOS

select * from USUARIOSPERMISSOES

delete from USUARIOS

delete from USUARIOSPERMISSOES